User manual for the barcode and dot extractor for DNA stretced on glass

The analysis is initiated via by the dnarec_skel routine (Type "dnarec_skel") in Matlab.

Inside the dnarec_skel.m file, the target folder (with the images) is specified in the "experiment.targetFolder" parameter in the first section. Note that the folder should not contain "~" but should be the full file path including the last slash, as in "/home/COMPUTERNAME/USERNAME/FOLDER/". 

If you wish to only analyze a single image, specify this in the "targetFile" parameter. If not, leave the definition empty (='';)

As this software is set up to analyse pairs of images, one with DNA molecules and one with "dots", it requires particular naming of the images in the folder:

	The names of the images showing barcodes due to fluouresence by YOYO must contain the flag defined in "experiment.barFlag".
	
	Similarly,

	The names of the images showing dots must contain the flag defined in "experiment.dotFlag".

        Example: If the YOYO fluoresence image always contains "CH1", such that all YOYO images are on the form "XXCH1YY.tif", set "experiment.barFlag = 'CH1'". Similarly, if the dot images are named on the form "XXCH2YY.tif", set "experiment.dotFlag = 'CH2'".

In order to extract barcodes, a file named "optics.txt" must be placed in the target folder along the images. This file must hold the NA, pixelsize, and wavelength of the flourescent light(for the molecule detection), along with an experiment name on the form

experiment lambdatest
NA 1.46
pixelsize 500
wavelength 509

such that the pixelsize and wavelength are given in nanometers.

If the same optics setup is used for many different measurements in different folders, the path of a specific optics file may be specified in the experiment.opticsFile variable. In this case, the file does not need to be present in all data folders.

One may tune the parameters which filter bad molecules, by changing the "TWEAK PARAMETERS" in the "segment_image.m" file. If "actions.showScores=1", the routine automatically plots a histogram of the scores generated by the regions in the images as a guide. Additionally the detected molecules are numbered in the original image and the LoG filtered image are shown.

Similarly, the "TWEAK PARAMETER", "pmin" in the detect_dots.m routine may be changed to filter away more or less significant dots.

An option for automated choice of the thresholds for molecule and dot scores has been added. To enforce automated thresholding of these, set "actions.autoThreshBars=1" and/or "actions.autoThreshDots=1".

In order to filter away any dots that are centered within the first X pixels of the molecule, set the parameter "sets.dotMargin = X". The number of dots filtered in this way is displayed in the command line when running the routine.

If "actions.saveMolecules=1", closeups of the detected molecules along with their barcode, if a such can be extracted, is saved in a "molecules" folder inside the target folder. These should be readily insertable into the CBC_Gui routine. Similarly, if "actions.saveBars=1", the molecule barcodes and barcode from the dot image are saved in the folders "barcodes" and "dotbars" respectively.

For each image where dots have been detected, the number of barcodes, total APPARENT length of barcodes, number of detected dots(within the barcode regions) and the average dots per micron are printed in a ...results(I).txt file. where (I) is an integer. The program automatically increases (I) by 1 for each analysis if an old ...results(I).txt file is present in the folder. When 10 such files are present, the new results are always saved as ...results10.txt

The software is now set up to handle massive data input at once, without having to insert the optics.txt file into each separate folder. The path of the optics file may be set in the "experiment.opticsFile" parameter by giving the full path of the optics file. Additionally, one may use the dnarec_folder_scan to analyse all subfolders in a given directory. The algorithm scans through all levels of subfolder in the given directory and runs the dnarec_skel routine on all SUITABLE subfolders;

   A subfolder is deemed "suitable" if
   1) Its name does not contain the phrase "molsandbars" or "movies"
   2) It has no subfolders inside it that fullfill point 1).

This means that if a folder has data images but also a subfolder which is does not contain the phrase "molsandbars" or "movies", the folder will be ignored.
